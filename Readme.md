# Snowblower

A lightweight high-performance Snowplow implementation in Go. Besides language choice, Snowblower differs from the official first party implementations the following ways:

- Snowblower supports SNS/SQS as the intermediate data store between stages
- Snowblower uses a JSON serialization for CollectorPayloads instead of Thrift.

Itâ€™d be rather trivial to add both a Kinesis stream as a destination for the collector as well as to support Thrift, at which point it would be a complete drop-in replacement for the Snowplow Scala Kinesis Collector.

## Performance and Cost

In initial testing, the collector service requires between 10 and 20 times fewer front-end compute resources than the Scala-based Snowplow Kinesis collector, based on the observation that we scaled down from 24 c3.xlarge machines to 2 on our initial deployment. There are likely many reasons other than the langauge choice including:

- Snowblower only ships collected payloads that have data. It ignores the large number of empty data requests generated by Snowplow trackers.
- The Scala-based Kinesis collector is clearly marked as beta and likely not optimized.


## On using SQS instead of Kinesis

One advantage to using SNS/SQS instead of Kinesis is that SQS scales transparently without explicit provisioning instruction.

## Running

Snowblower has two commands:

- `collect` Runs the collector, sending events to SNS or SQS, acting as the second stage in a Snowplow pipeline.
- `enrich` Pulls events from SQS, enriches them, and sends them into storage into Postgres or Redshift, acting as the third stage in a Snowplow pipeline.


## Configuration

The following environment variables configure the operation of Snowblower:

- `SNS_TOPIC` Must contain the ARN of the SNS topic to send events to. **REQUIRED**
- `PORT` Optionally sets the port that the server listens to. Defaults to 8080.
- `AWS_ACCESS_KEY_ID` and `AWS_SECRET_ACCESS_KEY` Amazon Web Services credentials. If not set, Snowblower will attempt to use IAM Roles.
- `COOKIE_DOMAIN` if not set, a domain won't be set on the session cookie
